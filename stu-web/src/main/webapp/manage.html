<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/fileinput.min.css">
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/fileinput.min.js"></script>

</head>
<body>
<form id="stuForm">
    <input type="hidden" name="img" id="img">
    <input type="hidden" name="id" id="id">
    姓名:<input type="text" name="name" id="name"><br/>
    地址：<input type="text" name="address" id="address"><br/>
    年龄：<input type="text" name="age" id="age"/><br/>
    生日：<input type="date" name="birthday" id="birthday"><br/>
    性别：
    <input type="radio" name="sex" value="1"/>男
    <input type="radio" name="sex" value="2"/>女<br/>
    图片： <input type="file" id="filename" name="file" ><br/>
    <input type="button" value="提交" onclick="saveManage()">
</form>

</body>
<script>

    var id=sessionStorage.getItem("id");
    sessionStorage.clear();
    if (id!=null && id!=""){
        $.ajax({
            url:"http://localhost:8082/stu/getInfoById",
            data:{"id":id},
            dataType:"json",
            type:"post",
            success:function (re) {
                if (re.code==200){
                    $("#id").val(re.data.id);
                    $("#img").val(re.data.img);
                    $("#name").val(re.data.name);
                    $("#age").val(re.data.age);
                    $("#address").val(re.data.address);
                    var sex=$("[name=sex]");
                    for (var i = 0; i < sex.length; i++) {
                        if (sex[i].value==re.data.sex){
                            $(sex[i]).attr("checked",true);
                        }
                    }
                    $("#birthday").val(chageDate(re.data.birthday));
                } else{
                    alert(re.message);
                }
            },error:function () {
                alert("请求失败");
            }
        })
    }

    function chageDate(date){
        var d=new Date(date);
        var y=d.getFullYear();
        var m=parseInt(d.getMonth()+1);
        var day=d.getDate();
        return y+"-"+m+"-"+day;
    }

    $("#filename").fileinput({
        language : 'zh',
        uploadUrl:"http://localhost:8082/stu/fileInput",
        showCaption : false,//是否显示标题,就是那个文本框
        dropZoneEnabled : false,//是否显示拖拽区域，默认不写为true，但是会占用很大区域	       //初始化 图片 用于修改
        initialPreview:[],
        initialPreviewAsData: true, // 特别重要
    }).on("fileuploaded",function (event, result, previewId, index) {
        var url=result.response.data;
        alert(JSON.stringify(result))
        $("#img").val(url);
    });

    function saveManage() {
        $.ajax({
            url:"http://localhost:8082/stu/saveManage",
            data:$("#stuForm").serialize(),
            dataType:"json",
            type:"post",
            success:function (re) {
                if (re.code==200){
                    location.href="/index.html";
                } else{
                    alert(re.message);
                }
            },error:function () {
                alert("请求失败");
            }
        })
    }




</script>
</html>